---
title: "Docker"
description:
  "Docker is the easiest way to get started with the self-hosted version of
  Lago."
---

## Lago Docker Deployment Guide

Docker provides a convenient way to set up and run the self-hosted version of Lago for development and testing purposes. This guide will walk you through the steps to deploy Lago using Docker Compose. **However, we strongly discourage using Docker Compose for production environments.** For production deployments, we recommend using Kubernetes with our Helm chart due to its robustness, scalability, and better support for high-availability configurations.

### Important Note for Production Use

Using Docker Compose in production is not recommended because it lacks the advanced features needed for scaling, load balancing, and seamless updates. Kubernetes, in conjunction with our Helm chart, provides a more secure and scalable solution suitable for production workloads.

---

## Requirements[](#requirements "Direct link to heading")

1. Install [Docker](https://docs.docker.com/get-docker/) on your machine;
2. Make sure [Docker Compose](https://docs.docker.com/compose/install/) is
   installed and available (it should be the case if you have chosen to install
   Docker via Docker Desktop); and
3. Make sure
   [Git](https://git-scm.com/book/en/v2/Getting-Started-Installing-Git) is
   installed on your machine.

### 1. Clone the Lago Repository

To start using Lago, run the following commands in a shell:

```shell
# Get the code
git clone https://github.com/getlago/lago.git

# Go to Lago folder
cd lago
```

## 2. Set Up Environment Variables


Create a `.env` file in the root directory of the Lago project and populate it with the necessary environment variables. Below is an example of what your `.env` file might look like (there is also a .env.example at the root of the repository):

```shell
DOMAIN=yourdomain.com
LAGO_API_URL=http://${DOMAIN}/api
LAGO_FRONT_URL=http://${DOMAIN}
POSTGRES_USER=lago
POSTGRES_PASSWORD=changeme
POSTGRES_DB=lago
POSTGRES_HOST=db
POSTGRES_PORT=5432
POSTGRES_SCHEMA=public
REDIS_HOST=redis
REDIS_PORT=6379
SECRET_KEY_BASE=your-secret-key-base-hex-64
LAGO_RSA_PRIVATE_KEY=your-base64-encoded-private-key
LAGO_ENCRYPTION_PRIMARY_KEY=your-encryption-primary-key
LAGO_ENCRYPTION_DETERMINISTIC_KEY=your-encryption-deterministic-key
LAGO_ENCRYPTION_KEY_DERIVATION_SALT=your-encryption-derivation-salt
```

Note: Replace placeholder values (e.g., `yourdomain.com`, `changeme`, `your-secret-key-base-hex-64`, etc.) with your actual configuration values.

## 3. Generate Required Keys and Secrets

*SECRET_KEY_BASE*: Generate using `openssl rand -hex 64`.
*LAGO_RSA_PRIVATE_KEY*: Generate using `openssl genrsa 2048 | base64`.
*LAGO_ENCRYPTION_PRIMARY_KEY*, *LAGO_ENCRYPTION_DETERMINISTIC_KEY*, *LAGO_ENCRYPTION_KEY_DERIVATION_SALT*: Generate each using `cat /dev/urandom | tr -dc 'a-zA-Z0-9' | fold -w 32 | head -n 1`.

## 4. Configure Docker Compose

Review the `docker-compose.new.yml` file provided. It includes several services:

* traefik: Acts as a reverse proxy and handles SSL termination.
* api: The Lago API service.
* front: The Lago frontend application.
* db: PostgreSQL database.
* redis: Redis cache.
* api-worker: Background worker for asynchronous tasks.
* api-clock: Scheduler for periodic tasks.
* pdf: Service for PDF generation.

### Traefik Configuration:

Ensure that the DOMAIN environment variable is set correctly in your .env file. Traefik uses this variable to route traffic and obtain SSL certificates from Let's Encrypt.

## Using Traefik with HTTPS on Localhost Using a Self-Signed Certificate :

When working with Traefik in a local development environment, you might want to enable HTTPS on `localhost`. Since Let's Encrypt does not issue certificates for `localhost`, you'll need to use a self-signed certificate. This documentation will guide you through the process of modifying your docker-compose.yml file to use a self-signed certificate with Traefik.

### Generating a Self-Signed Certificate

```shelm
openssl req -x509 -newkey rsa:4096 -sha256 -days 365 -nodes \
  -keyout cert.key -out cert.crt -subj "/CN=localhost"
```

This command creates two files in your current directory:

* cert.crt: The self-signed certificate.
* cert.key: The private key for the certificate.

Note: Keep these files secure, even though they are for local development.

### Modifying docker-compose.yml

#### 1. Commenting Out Let's Encrypt Configuration

In your existing `docker-compose.yml`, locate the Traefik service configuration. You'll need to comment out or remove the Let's Encrypt-related lines since they are not applicable for `localhost`.

Locate and comment out the following lines in the `command` section:

```shell
# --certificatesresolvers.lagoresolver.acme.tlschallenge=true
# --certificatesresolvers.lagoresolver.acme.email=youremail@domain.tld
# --certificatesresolvers.lagoresolver.acme.storage=/letsencrypt/acme.json
```

Also, comment out the labels related to TLS certificate resolution:

```
# - "traefik.http.routers.traefik.tls.certresolver=lagoresolver"
```

#### 2. Adding Self-Signed Certificate Configuration

Now, you'll add configuration to tell Traefik to use your self-signed certificate.

In the `volumes` section, add:

```
- "./cert.crt:/certs/cert.crt"
- "./cert.key:/certs/cert.key"
```

This mounts your self-signed certificate and key into the Traefik container.

In the `command` section, add or modify:

```shell
- "--entrypoints.websecure.address=:443"
- "--entrypoints.websecure.http.tls=true"
- "--entrypoints.websecure.http.tls.certificates[0].certFile=/certs/cert.crt"
- "--entrypoints.websecure.http.tls.certificates[0].keyFile=/certs/cert.key"
```

These lines configure Traefik to use the self-signed certificate for the `websecure` entrypoint.

#### Final docker-compose.yml Example

Here is how your Traefik service should look after modifications ( /!\ only for localhost purpose /!\):

```yaml
services:
  traefik:
    image: traefik:v2.5
    container_name: traefik
    restart: unless-stopped
    command:
      - "--api.insecure=false"
      - "--api.dashboard=true"
      - "--providers.docker=true"
      - "--providers.docker.exposedbydefault=false"
      - "--entrypoints.web.address=:80"
      - "--entrypoints.websecure.address=:443"
      - "--entrypoints.websecure.http.tls=true"
      - "--entrypoints.websecure.http.tls.certificates[0].certFile=/certs/cert.crt"
      - "--entrypoints.websecure.http.tls.certificates[0].keyFile=/certs/cert.key"
      # Commented out Let's Encrypt configuration
      # - "--certificatesresolvers.lagoresolver.acme.tlschallenge=true"
      # - "--certificatesresolvers.lagoresolver.acme.email=youremail@domain.tld"
      # - "--certificatesresolvers.lagoresolver.acme.storage=/letsencrypt/acme.json"
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - "/var/run/docker.sock:/var/run/docker.sock:ro"
      - "./cert.crt:/certs/cert.crt"
      - "./cert.key:/certs/cert.key"
      # Commented out Let's Encrypt volume
      # - traefik_certificates:/letsencrypt
      - traefik_config:/traefik
    labels:
      - "traefik.http.routers.traefik.rule=Host(`localhost`)"
      - "traefik.http.routers.traefik.entrypoints=websecure"
      # Commented out TLS certificate resolver label
      # - "traefik.http.routers.traefik.tls.certresolver=lagoresolver"
      - "traefik.http.services.traefik.loadbalancer.server.port=8080"
```

#### Notes :

Browser Warnings: When accessing `https://localhost`, your browser will display a security warning because the certificate is self-signed. You can safely ignore this warning for local development.
Trusting the Certificate: To eliminate browser warnings, you can add the self-signed certificate to your system's trusted certificates store.
Environment Variables: Ensure that the DOMAIN environment variable is set to `localhost` if used elsewhere in your configuration.
Cleaning Up: Remember that self-signed certificates should not be used in production environments.


## 5. Start the Services

```shell
# Start the api
docker compose up -d api

# Create the database
docker compose exec api rails db:create
docker compose exec api rails db:migrate

# Start all other components
docker compose up

```

# Accessing Lago

Once the setup is complete, you can access the Lago application by navigating to `https://yourdomain.com` in your web browser.


## Signing up[](#signing-up "Direct link to heading")

It's mandatory to create your organization by signing up to Lago. This
organization is the core object of your biller as it's used to invoice your
customers.

1. Write down your `organization name`;
2. Use the main billing `email` of your company; and
3. Define the admin `password` for this email.

You will be able to **invite other email addresses within the application**. If
you already have an account, you can also log in. Once you are able to access
the app, you can retrieve your API key.

## Find your API Key[](#find-your-api-key "Direct link to heading")

Your API Key can be found directly in the UI:

1. Access the **Developer** section from the sidebar;
2. The first tab of this section is related to your **API keys**; and
3. Click the **Copy** button to copy it to clipboard.

## Configuration[](#configuration "Direct link to heading")

### Version[](#version "Direct link to heading")

Docker images are always updated to the last stable version in the
`docker-compose.yml` file. You can use a different tag if needed by checking the
[releases list](https://github.com/getlago/lago/releases).

<Warning>
  We recommend to avoid the usage of `latest` tag, you should use the last
  tagged version, you can track what are the last version on Dockerhub
</Warning>

- lago-api :
  [https://hub.docker.com/repository/docker/getlago/api](https://hub.docker.com/repository/docker/getlago/api)
- lago-front :
  [https://hub.docker.com/repository/docker/getlago/front](https://hub.docker.com/repository/docker/getlago/front)

### Environment variables[](#environment-variables "Direct link to heading")

Lago uses the following environment variables to configure the components of the
application. You can override them to customise your setup.

| Variable                            | Default value                           | Description                                                                                                                                                      |
| ----------------------------------- | --------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `POSTGRES_HOST`                       | db                                      | (_With Docker compose_) Host name of the postgres server                                                                                                                                 |
| `POSTGRES_DB`                         | lago                                    | (_With Docker compose_) Name of the postgres database                                                                                                                                    |
| `POSTGRES_USER`                       | lago                                    | (_With Docker compose_) Database user for postgres connection                                                                                                                            |
| `POSTGRES_PASSWORD`                   | changeme                                | (_With Docker compose_) Database password for postgres connection                                                                                                                        |
| `POSTGRES_PORT`                       | 5432                                    | (_With Docker compose_) Port the postgres database listens to                                                                                                                            |
| `POSTGRES_SCHEMA`                     | public                                  | Name of the postgres schema
| `DATABASE_URL`                        |                                         | (_Without docker compose_) Full url to the postgres server
| `DATABASE_POOL`                       | 10                                      | Max number of connection opened to the postgres database per api, worker and clock instances
| `DATABASE_PREPARED_STATEMENTS`        | true                                    | Enable or disable prepared statements in the postgres database
| `REDIS_HOST`                          | redis                                   | Host name of the redis server                                                                                                                                    |
| `REDIS_PORT`                          | 6379                                    | Port the redis database listens to                                                                                                                               |
| `REDIS_PASSWORD`                      |                                         | Password of the redis server                                                                                                                                     |
| `LAGO_REDIS_CACHE_HOST`               | redis                                   | Host name of the redis cache server                                                                                                                              |
| `LAGO_REDIS_CACHE_PORT`               | 6379                                    | Port the redis cache server listens to                                                                                                                           |
| `LAGO_REDIS_CACHE_PASSWORD`           |                                         | Password of the redis cache server                                                                                                                               |
| `LAGO_MEMCACHE_SERVERS`               |                                         | Coma separated list of memcache servers                                                                                                                          |
| `LAGO_FRONT_URL`                      | [http://localhost](http://localhost)    | URL of the Lago front-end application.Used for CORS configuration                                                                                                |
| `FRONT_PORT`                          | 80                                      | Port the front-end application listens to                                                                                                                        |
| `LAGO_API_URL`                        | [http://localhost/api](http://localhost/api) | URL of the Lago back-end application                                                                                                                      |
| `API_URL`                             | [http://localhost/api](http://localhost/api) | URL of the Lago back-end application defined for the front image                                                                                          |
| `API_PORT`                            | 3000                                    | Port the back-end application listens to                                                                                                                         |
| `SECRET_KEY_BASE`                     | your-secret-key-base-hex-64             | Secret key used for session encryption                                                                                                                           |
| `SENTRY_DSN`                          |                                         | Sentry DSN key for error and performance tracking on Lago back-end                                                                                               |
| `SENTRY_DSN_FRONT`                    |                                         | Sentry DSN key for error and performance tracking on Lago front-end                                                                                              |
| `LAGO_RSA_PRIVATE_KEY`                |                                         | Private key used for webhook signatures                                                                                                                          |
| `LAGO_SIDEKIQ_WEB`                    |                                         | Activate the Sidekiq web UI, disabled by default                                                                                                                 |
| `LAGO_ENCRYPTION_PRIMARY_KEY`         | your-encryption-primary-key             | Encryption primary key used to secure sensitive values stored in the database                                                                                    |
| `LAGO_ENCRYPTION_DETERMINISTIC_KEY`   | your-encryption-deterministic-key       | Encryption deterministic key used to secure sensitive values stored in the database                                                                              |
| `LAGO_ENCRYPTION_KEY_DERIVATION_SALT` | your-encryption-derivation-salt         | Encryption key salt used to secure sensitive values stored in the database                                                                                       |
| `LAGO_WEBHOOK_ATTEMPTS`               | 3                                       | Number of failed attempt before stopping to deliver a webhook                                                                                                    |
| `LAGO_USE_AWS_S3`                     | false                                   | Use AWS S3 for files storage                                                                                                                                     |
| `LAGO_AWS_S3_ACCESS_KEY_ID`           | azerty123456                            | AWS Access Key id that has access to S3                                                                                                                          |
| `LAGO_AWS_S3_SECRET_ACCESS_KEY`       | azerty123456                            | AWS Secret Access Key that has access to S3                                                                                                                      |
| `LAGO_AWS_S3_REGION`                  | us-east-1                               | AWS S3 Region                                                                                                                                                    |
| `LAGO_AWS_S3_BUCKET`                  | bucket                                  | AWS S3 Bucket name                                                                                                                                               |
| `LAGO_AWS_S3_ENDPOINT`                |                                         | S3 compatible storage endpoint. Should be set only if you are using another storage provider than AWS S3                                                         |
| `LAGO_USE_GCS`                        | false                                   | Use Google Cloud Service Cloud Storage for file storage, ⚠️ If you want to use GCS, you have to pass the credentials json key file to the api and worker service |
| `LAGO_GCS_PROJECT`                    |                                         | GCS Project name                                                                                                                                                 |
| `LAGO_GCS_BUCKET`                     |                                         | GCS Bucket Name                                                                                                                                                  |
| `LAGO_PDF_URL`                        | [http://pdf:3000](http://pdf:3000)      | PDF Service URL on your infrastructure                                                                                                                           |
| `LAGO_DISABLE_SIGNUP`                 |                                         | Disable Sign up when running Lago in self-hosted                                                                                                                 |
| `LAGO_RAILS_STDOUT`                   | true                                    | Set to true to activate logs on containers                                                                                                                       |
| `LAGO_DISABLE_WALLET_REFRESH`         |                                         | Disable automatic refresh of wallet ongoing balance                                                                                                              |
| `GOOGLE_AUTH_CLIENT_ID`          |                                         | Client ID for Google auth Single Sign On                                                                                                                         |
| `GOOGLE_AUTH_CLIENT_SECRET`      |                                         | Client Secret for Google auth Single Sign On                                                                                                                     |

<Warning>
We recommend that you change `POSTGRES_PASSWORD`, `SECRET_KEY_BASE`,
`LAGO_RSA_PRIVATE_KEY`, `LAGO_ENCRYPTION_PRIMARY_KEY`,
`LAGO_ENCRYPTION_DETERMINISTIC_KEY` and `LAGO_ENCRYPTION_KEY_DERIVATION_SALT` to
improve the security of your Lago instance:

- `SECRET_KEY_BASE` can be generated using the `openssl rand -hex 64` command.
- `LAGO_RSA_PRIVATE_KEY` can be generated using the
  `openssl genrsa 2048 | base64` command.
- `LAGO_ENCRYPTION_PRIMARY_KEY`, `LAGO_ENCRYPTION_DETERMINISTIC_KEY` and
  `LAGO_ENCRYPTION_KEY_DERIVATION_SALT` can all be gerated using the
  `cat /dev/urandom | tr -dc 'a-zA-Z0-9' | fold -w 32 | head -n 1` command.

</Warning>

### Components[](#components "Direct link to heading")

Lago uses the following containers:

| Container  | Role                                                                  |
| ---------- | --------------------------------------------------------------------- |
| `front`      | Front-end application                                                 |
| `api`        | API back-end application                                              |
| `api_worker` | Asynchronous worker for the API application                           |
| `api_clock`  | Clock worker for the API application                                  |
| `db`         | Postgres database engine used to store application data               |
| `redis`      | Redis database engine used as a queuing system for asynchronous tasks |
| `pdf`        | PDF generation powered by Gotenberg                                   |

You can also use your own database or Redis server. To do so, remove the `db`
and `redis` configurations from the `docker-compose.yml` file and update the
environment variables accordingly.

### SSL Support[](#ssl-support "Direct link to heading")

Lago Front application can be configured to support SSL certificates. You have
two options to achieve this:

- by using a self-signed certificate
- by using a signed certificate generated by Let's Encrypt


### Storage[](#storage "Direct link to heading")

By default, Lago uses the internal storage of the container. You can customize
it by defining different environment variables.

We currently support :

- AWS S3
- AWS S3 Compatibles Endpoints
- Google Cloud Service Cloud Storage

<Warning>
  If you use S3 compatibles endpoints, you should set the `LAGO_AWS_S3_REGION`
  to a default value (ei: `us-east-1`), it is required to work properly!
</Warning>

#### AWS S3[](#aws-s3 "Direct link to heading")

You have to set these variables to use AWS S3.

| Name                          | Description                             |
| ----------------------------- | --------------------------------------- |
| `LAGO_USE_AWS_S3`               | Set to "true" if you want to use AWS S3 |
| `LAGO_AWS_S3_ACCESS_KEY_ID`     | AWS S3 Credentials Access Key Id        |
| `LAGO_AWS_S3_SECRET_ACCESS_KEY` | AWS S3 Credentials Secret Access Key    |
| `LAGO_AWS_S3_REGION`            | AWS S3 Region                           |
| `LAGO_AWS_S3_BUCKET`            | AWS S3 Bucket                           |

#### AWS S3 Compatible Endpoints[](#aws-s3-compatible-endpoints "Direct link to heading")

You have to set these variables to use AWS S3 Compatible Endpoints.

| Name                          | Description                                                  |
| ----------------------------- | ------------------------------------------------------------ |
| `LAGO_USE_AWS_S3`               | Set to "true" if you want to use AWS S3 Compatible Endpoints |
| `LAGO_AWS_S3_ENDPOINT`          | AWS S3 Compatible Endpoint                                   |
| `LAGO_AWS_S3_ACCESS_KEY_ID`     | AWS S3 Credentials Access Key Id                             |
| `LAGO_AWS_S3_SECRET_ACCESS_KEY` | AWS S3 Credentials Secret Access Key                         |
| `LAGO_AWS_S3_BUCKET`            | AWS S3 Bucket                                                |
| `LAGO_AWS_S3_REGION`            | Not used but required by the AWS SDK                         |

#### Google Cloud Service Cloud Storage[](#google-cloud-service-cloud-storage "Direct link to heading")

You have to set those variables to use GCS Cloud Storage.

| Name             | Description                                        |
| ---------------- | -------------------------------------------------- |
| `LAGO_USE_GCS`     | Set to "true" if you want to use GCS Cloud Storage |
| `LAGO_GCS_PROJECT` | GCS Project name                                   |
| `LAGO_GCS_BUCKET`  | GCS Bucket name                                    |

In the `docker-compose.yml` file, you must uncomment the lines and pass the
correct GCS credentials json file.

```yaml
api:
  volumes:
    - gcs_keyfile.json:/app/gcs_keyfile.json

api-worker:
  volumes:
    - gcs_keyfile.json:/app/gcs_keyfile.json
```

### SMTP Configuration[](#smtp-configuration")

In order to use the email feature, you need to configure some environment variables.

<Warning>
  In addition to this configuration, defining an organization email in Settings > Organization is mandatory; without it, emails will not be sent.
</Warning>

|Name|Description|
|--|--|
| `LAGO_FROM_EMAIL` | Required to send emails (i.e: [noreply@getlago.com](mailto:noreply@getlago.com)) |
| `LAGO_SMTP_ADDRESS` | Address of the SMTP server |
| `LAGO_SMTP_PORT` | Port of the SMTP Server |
| `LAGO_SMTP_USERNAME` | Username of the SMTP Server |
| `LAGO_SMTP_PASSWORD` | Password of the SMTP Server |

#### Single Sign On using Google authentication[](#single-sign-on-using-google-authentication)

In order to enable Google authentication for single sign on, you have to set those variables.

|Name|Description|
|--|--|
| `GOOGLE_AUTH_CLIENT_ID`     | Client ID for Google auth Single Sign On     |
| `GOOGLE_AUTH_CLIENT_SECRET` | Client Secret for Google auth Single Sign On |
